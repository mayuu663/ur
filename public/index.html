<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ÁàÜ„Ç¢„Éâ„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #fff8fc;
    }
    canvas {
      display: block;
      background: linear-gradient(to bottom, #ffeef6, #ffffff);
    }
    #controls {
      position: absolute;
      bottom: 20px;
      width: 100%;
      display: flex;
      justify-content: space-between;
      padding: 0 20px;
    }
    .controlBtn {
      font-size: 24px;
      padding: 16px 32px;
      border-radius: 16px;
      border: none;
      background: #ffb6c1;
      color: white;
      flex: 1;
      margin: 0 5px;
    }
    #timerDisplay {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 18px;
      font-weight: bold;
      background: rgba(255, 255, 255, 0.7);
      padding: 4px 8px;
      border-radius: 8px;
    }
    #result {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 24px;
      font-weight: bold;
      background: rgba(255,255,255,0.9);
      padding: 20px;
      border-radius: 16px;
      display: none;
    }
    #startScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.95);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    #startButton {
      font-size: 28px;
      padding: 20px 40px;
      border-radius: 20px;
      background: #ff69b4;
      color: white;
      border: none;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="400" height="600"></canvas>
  <div id="controls">
    <button id="leftBtn" class="controlBtn">‚Üê</button>
    <button id="rightBtn" class="controlBtn">‚Üí</button>
    <button id="shootBtn" class="controlBtn">ÊíÉ„Å§ÔºÅ</button>
  </div>
  <div id="timerDisplay">30Áßí</div>
  <div id="result"></div>
  <div id="startScreen">
    <button id="startButton">„Ç≤„Éº„É†„Çπ„Çø„Éº„ÉàÔºÅ</button>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const playerImgFront = new Image();
    const playerImgLeft = new Image();
    const playerImgRight = new Image();
    const playerImgHeart = new Image();
    playerImgFront.src = 'front.png';
    playerImgLeft.src = 'left.png';
    playerImgRight.src = 'right.png';
    playerImgHeart.src = 'heart.png';

    const enemyImg1 = new Image();
    const enemyImg2 = new Image();
    enemyImg1.src = 'note-cute1.png';
    enemyImg2.src = 'note-cute2.png';

    const bulletImg = new Image();
    bulletImg.src = 'bullet.png';

    let currentImg = playerImgFront;

    const player = {
      x: 180,
      y: 500,
      width: 60,
      height: 60,
      speed: 5
    };

    const bullets = [];
    const enemies = [];
    let score = 0;

    let moveLeft = false;
    let moveRight = false;
    let lastShotTime = 0;
    const shotCooldown = 250;

    let gameTime = 30;
    let gameInterval;
    let enemySpawnInterval;
    let bonusTime = false;
    const timerDisplay = document.getElementById('timerDisplay');
    const resultDisplay = document.getElementById('result');

    function getTitle(score) {
      if (score >= 150) return 'üåà Á•ûË©±Á¥ö„Ç¢„Ç§„Éâ„É´Á†≤Á•ûüëë';
      if (score >= 100) return 'üí• Ë∂ÖÊ¨°ÂÖÉ„Ç¢„Ç§„Éâ„É´Á†¥Â£äÁéã';
      if (score >= 90) return 'üî• ÁàÜË£ÇÂÖ®ÂºæÂëΩ‰∏≠„Éû„Çπ„Çø„Éº';
      if (score >= 80) return 'üí´ Èü≥ÈÄüË∂Ö„Åà„ÅÆ„Çπ„Çø„Éº„Ç∑„É•„Éº„Çø„Éº';
      if (score >= 70) return 'üöÄ Ë∂ÖÁµ∂ÂèçÂøú„Ç¢„ÉâÈÄ£Â∞ÑÂß´';
      if (score >= 60) return 'üåü Ê•µÈôê„Åã„Çè„ÅÑ„ÅïÈÄ£ÊâìËÅ∑‰∫∫';
      if (score >= 50) return 'üëë ÁàÜ„Ç¢„Éâ„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞Á•ûÔºÅ';
      if (score >= 40) return 'üí´ Ë∂ÖÈÄ£Â∞Ñ„ÅÆÈ¨º';
      if (score >= 30) return 'üí™ Êú¨Ê∞ó„ÅÆ„Ç¢„Ç§„Éâ„É´';
      if (score >= 20) return 'üåü „Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞Ë¶ãÁøí„ÅÑ';
      if (score >= 10) return 'ü•ö „Åæ„Å†„Åæ„Å†„Åì„Çå„Åã„ÇâÔºÅ';
      return 'üò¢ ÊíÉ„Åü„ÇåÊîæÈ°å„Ç¢„Ç§„Éâ„É´ÂÄôË£úÁîü';
    }

    function drawPlayer() {
      ctx.drawImage(currentImg, player.x, player.y, player.width, player.height);
    }

    function drawBullets() {
      bullets.forEach((b) => {
        ctx.drawImage(bulletImg, b.x - 10, b.y - 10, 20, 20);
      });
    }

    function drawEnemies() {
      enemies.forEach((e) => {
        const img = e.type === 1 ? enemyImg1 : enemyImg2;
        ctx.drawImage(img, e.x, e.y, e.width, e.height);
      });
    }

    function updateBullets() {
      bullets.forEach((b, index) => {
        b.y -= b.speed;
        if (b.y < 0) bullets.splice(index, 1);
      });
    }

    function updateEnemies() {
      enemies.forEach((e, index) => {
        e.y += e.speedY;
        e.x += e.speedX;
        if (e.x < 0 || e.x > canvas.width - e.width) e.speedX *= -1;
        if (e.y > canvas.height) enemies.splice(index, 1);
      });
    }

    function detectCollisions() {
      bullets.forEach((b, bIndex) => {
        enemies.forEach((e, eIndex) => {
          if (
            b.x > e.x &&
            b.x < e.x + e.width &&
            b.y > e.y &&
            b.y < e.y + e.height
          ) {
            bullets.splice(bIndex, 1);
            enemies.splice(eIndex, 1);
            score++;
          }
        });
      });
    }

    function drawScore() {
      ctx.fillStyle = '#000';
      ctx.font = '20px sans-serif';
      ctx.fillText(`„Çπ„Ç≥„Ç¢: ${score}`, 10, 30);
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (moveLeft) player.x = Math.max(0, player.x - player.speed);
      if (moveRight) player.x = Math.min(canvas.width - player.width, player.x + player.speed);

      drawPlayer();
      drawBullets();
      drawEnemies();
      drawScore();
      updateBullets();
      updateEnemies();
      detectCollisions();
      requestAnimationFrame(gameLoop);
    }

    function shoot() {
      const now = Date.now();
      if (now - lastShotTime < shotCooldown) return;
      lastShotTime = now;
      bullets.push({ x: player.x + player.width / 2, y: player.y, speed: 7 });
      currentImg = playerImgHeart;
      setTimeout(() => currentImg = playerImgFront, 200);
    }

    function spawnEnemy(count = 1) {
      for (let i = 0; i < count; i++) {
        const width = 40;
        const height = 40;
        const type = Math.random() < 0.5 ? 1 : 2;
        enemies.push({
          x: Math.random() * (canvas.width - width),
          y: -height,
          width: width,
          height: height,
          speedY: 2 + Math.random() * 2,
          speedX: (Math.random() - 0.5) * 4,
          type: type
        });
      }
    }

    function startGame() {
      gameTime = 30;
      timerDisplay.textContent = `${gameTime}Áßí`;

      gameInterval = setInterval(() => {
        gameTime--;
        timerDisplay.textContent = `${gameTime}Áßí`;

        bonusTime = gameTime <= 10;

        if (gameTime <= 0) {
          clearInterval(gameInterval);
          clearInterval(enemySpawnInterval);
          resultDisplay.textContent = `„ÅÇ„Å™„Åü„ÅÆÁß∞Âè∑Ôºö${getTitle(score)}\n„Çπ„Ç≥„Ç¢Ôºö${score}`;
          resultDisplay.style.display = 'block';
        }
      }, 1000);

      enemySpawnInterval = setInterval(() => {
        if (gameTime <= 5) {
          spawnEnemy(6);
        } else if (bonusTime) {
          spawnEnemy(3);
        } else {
          spawnEnemy(1);
        }
      }, 400);
    }

    document.getElementById('startButton').addEventListener('click', () => {
      document.getElementById('startScreen').style.display = 'none';
      startGame();
    });

    gameLoop();

    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');
    const shootBtn = document.getElementById('shootBtn');

    leftBtn.addEventListener('touchstart', () => { moveLeft = true; currentImg = playerImgLeft; });
    leftBtn.addEventListener('touchend', () => { moveLeft = false; currentImg = playerImgFront; });
    rightBtn.addEventListener('touchstart', () => { moveRight = true; currentImg = playerImgRight; });
    rightBtn.addEventListener('touchend', () => { moveRight = false; currentImg = playerImgFront; });
    shootBtn.addEventListener('touchstart', () => shoot());

    leftBtn.addEventListener('mousedown', () => { moveLeft = true; currentImg = playerImgLeft; });
    leftBtn.addEventListener('mouseup', () => { moveLeft = false; currentImg = playerImgFront; });
    rightBtn.addEventListener('mousedown', () => { moveRight = true; currentImg = playerImgRight; });
    rightBtn.addEventListener('mouseup', () => { moveRight = false; currentImg = playerImgFront; });
    shootBtn.addEventListener('click', () => shoot());

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') { moveLeft = true; currentImg = playerImgLeft; }
      if (e.key === 'ArrowRight') { moveRight = true; currentImg = playerImgRight; }
      if (e.key === ' ' || e.key === 'Enter') shoot();
    });
    document.addEventListener('keyup', (e) => {
      if (e.key === 'ArrowLeft') { moveLeft = false; currentImg = playerImgFront; }
      if (e.key === 'ArrowRight') { moveRight = false; currentImg = playerImgFront; }
    });
  </script>
</body>
</html>
