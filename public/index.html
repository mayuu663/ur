<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>爆アドシューティング</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #fff8fc;
    }
    canvas {
      display: block;
      background: linear-gradient(to bottom, #ffeef6, #ffffff);
    }
    #leftBtn, #rightBtn, #shootBtn {
      position: absolute;
      bottom: 20px;
      font-size: 20px;
      padding: 10px;
      border-radius: 10px;
      border: none;
      background: #ffb6c1;
      color: white;
    }
    #leftBtn { left: 20px; }
    #rightBtn { left: 100px; }
    #shootBtn { right: 20px; }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="400" height="600"></canvas>
  <button id="leftBtn">←</button>
  <button id="rightBtn">→</button>
  <button id="shootBtn">撃つ！</button>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const playerImgFront = new Image();
    const playerImgLeft = new Image();
    const playerImgRight = new Image();
    const playerImgHeart = new Image();
    playerImgFront.src = 'front.png';
    playerImgLeft.src = 'left.png';
    playerImgRight.src = 'right.png';
    playerImgHeart.src = 'heart.png';

    let currentImg = playerImgFront;

    const player = {
      x: 180,
      y: 500,
      width: 60,
      height: 60,
      speed: 5
    };

    const bullets = [];
    const enemies = [];
    let score = 0;

    function drawPlayer() {
      ctx.drawImage(currentImg, player.x, player.y, player.width, player.height);
    }

    function drawBullets() {
      ctx.fillStyle = '#ff80da';
      bullets.forEach((b) => {
        ctx.beginPath();
        ctx.arc(b.x, b.y, 5, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function drawEnemies() {
      ctx.fillStyle = '#9999ff';
      enemies.forEach((e) => {
        ctx.fillRect(e.x, e.y, e.width, e.height);
      });
    }

    function updateBullets() {
      bullets.forEach((b, index) => {
        b.y -= b.speed;
        if (b.y < 0) bullets.splice(index, 1);
      });
    }

    function updateEnemies() {
      enemies.forEach((e, index) => {
        e.y += e.speedY;
        e.x += e.speedX;
        if (e.x < 0 || e.x > canvas.width - e.width) e.speedX *= -1;
        if (e.y > canvas.height) enemies.splice(index, 1);
      });
    }

    function detectCollisions() {
      bullets.forEach((b, bIndex) => {
        enemies.forEach((e, eIndex) => {
          if (
            b.x > e.x &&
            b.x < e.x + e.width &&
            b.y > e.y &&
            b.y < e.y + e.height
          ) {
            bullets.splice(bIndex, 1);
            enemies.splice(eIndex, 1);
            score++;
          }
        });
      });
    }

    function drawScore() {
      ctx.fillStyle = '#000';
      ctx.font = '20px sans-serif';
      ctx.fillText(`スコア: ${score}`, 10, 30);
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPlayer();
      drawBullets();
      drawEnemies();
      drawScore();
      updateBullets();
      updateEnemies();
      detectCollisions();
      requestAnimationFrame(gameLoop);
    }

    function shoot() {
      bullets.push({ x: player.x + player.width / 2, y: player.y, speed: 7 });
      currentImg = playerImgHeart;
      setTimeout(() => currentImg = playerImgFront, 200);
    }

    function spawnEnemy() {
      const width = 30;
      const height = 30;
      enemies.push({
        x: Math.random() * (canvas.width - width),
        y: -height,
        width: width,
        height: height,
        speedY: 2 + Math.random() * 2,
        speedX: (Math.random() - 0.5) * 4
      });
    }

    setInterval(spawnEnemy, 1000);
    gameLoop();

    document.getElementById('leftBtn').addEventListener('click', () => {
      player.x = Math.max(0, player.x - player.speed);
      currentImg = playerImgLeft;
      setTimeout(() => currentImg = playerImgFront, 200);
    });

    document.getElementById('rightBtn').addEventListener('click', () => {
      player.x = Math.min(canvas.width - player.width, player.x + player.speed);
      currentImg = playerImgRight;
      setTimeout(() => currentImg = playerImgFront, 200);
    });

    document.getElementById('shootBtn').addEventListener('click', () => {
      shoot();
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        player.x = Math.max(0, player.x - player.speed);
        currentImg = playerImgLeft;
        setTimeout(() => currentImg = playerImgFront, 200);
      }
      if (e.key === 'ArrowRight') {
        player.x = Math.min(canvas.width - player.width, player.x + player.speed);
        currentImg = playerImgRight;
        setTimeout(() => currentImg = playerImgFront, 200);
      }
      if (e.key === ' ' || e.key === 'Enter') shoot();
    });
  </script>
</body>
</html>
